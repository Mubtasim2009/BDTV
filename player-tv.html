<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>BDTV VOD – TV Player</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <link rel="icon" type="image/webp" href="https://raw.githubusercontent.com/Mubtasim2009/Aboutme/c74e8b467a2abce57120a9b1d39eb0edb8e1c038/assets/brand/ICON.webp" />

  <style>
    :root {
      color-scheme: dark;
      --bg-main: #020916;
      --accent: #e50914;
      --text-main: #f5f5f5;
      --text-muted: #a7b0c5;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      min-height: 100vh;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text", "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #101933 0, #020916 55%);
      color: var(--text-main);
      display: flex;
      flex-direction: column;
    }

    a { color: inherit; text-decoration: none; }

    .top-nav{
      padding:1.1rem 5vw 0.4rem;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:1.5rem;
    }
    .top-brand img{height:32px}

    main {
      flex:1;
      padding:0.6rem 5vw 1.6rem;
      display:grid;
      grid-template-columns:minmax(0,2.2fr) minmax(0,1fr);
      gap:1.2rem;
    }

    .player-card{background:rgba(4,8,24,0.96);border-radius:12px;padding:12px;border:1px solid rgba(255,255,255,0.04);box-shadow:0 18px 50px rgba(0,0,0,0.85)}
    .title{font-size:1.1rem;font-weight:600}
    .meta{font-size:.85rem;color:var(--text-muted);margin-bottom:.4rem}

    .vidking-wrapper{position:relative;width:100%;aspect-ratio:16/9;border-radius:10px;overflow:hidden;background:#000}
    .vidking-wrapper iframe{width:100%;height:100%;border:0;display:block}

    .info-card{background: rgba(4,8,24,0.96);border-radius:12px;padding:12px;border:1px solid rgba(255,255,255,0.04);box-shadow:0 18px 50px rgba(0,0,0,0.85);display:flex;flex-direction:column;gap:.6rem}

    .poster-wrapper{display:flex;gap:.8rem;align-items:flex-start}
    .poster-wrapper img{width:120px;border-radius:6px;object-fit:cover}

    .overview{font-size:.9rem;color:var(--text-muted);line-height:1.45}

    .cast-section { margin-top: 0.6rem; }
    .cast-title { font-size: 0.95rem; font-weight: 700; margin-bottom: 0.5rem; }
    .cast-list { display:flex;gap:10px;overflow-x:auto;padding-bottom:6px; }
    .cast-item { width:96px; flex:0 0 auto; display:flex; flex-direction:column; gap:6px; align-items:center; cursor:pointer; text-align:center; }
    .cast-item img { width:96px;height:96px;border-radius:8px;object-fit:cover; border:1px solid rgba(255,255,255,0.04); background:#0a0a0a; }
    .cast-name { font-size:.8rem; font-weight:600; overflow:hidden; white-space:nowrap; text-overflow:ellipsis; width:100%; }
    .cast-character { font-size:.72rem;color:var(--text-muted);overflow:hidden;white-space:nowrap;text-overflow:ellipsis;width:100%; }

    footer{padding:.8rem 5vw 1.2rem;color:var(--text-muted);font-size:.75rem;border-top:1px solid rgba(255,255,255,0.04);text-align:center}

    @media(max-width:900px){ main{grid-template-columns:1fr} .poster-wrapper img{width:110px} .cast-item{width:84px} .cast-item img{width:84px;height:84px} }
  </style>
</head>
<body>
  <header class="top-nav">
    <a class="top-brand" href="index.html"><img src="https://raw.githubusercontent.com/Mubtasim2009/Aboutme/c74e8b467a2abce57120a9b1d39eb0edb8e1c038/assets/brand/LOGO.webp" alt="logo" /></a>
    <div class="top-right">
      <nav class="nav-links">
        <a href="index.html" class="nav-home">Home</a>
        <a href="search.html" class="nav-search">Search</a>
        <a href="about.html" class="nav-about">About</a>
      </nav>
      <button class="live-btn-nav" onclick="location.href='live.html'">Live TV</button>
    </div>
  </header>

  <main>
    <section class="player-card">
      <div class="title" id="tvTitle">Loading…</div>
      <div class="meta" id="tvMeta"></div>

      <div class="vidking-wrapper">
        <iframe id="tvFrame" allowfullscreen referrerpolicy="no-referrer"></iframe>
      </div>

      <p class="disclaimer">Streams are provided by a third‑party host and may contain their own ads or external links.</p>

      <div id="castSection" class="cast-section" style="display:none;">
        <div class="cast-title">Top Cast</div>
        <div id="castList" class="cast-list"></div>
      </div>
    </section>

    <aside class="info-card">
      <div class="poster-wrapper">
        <img id="posterImg" src="" alt="Poster" />
        <div style="flex:1">
          <div class="tags" id="tvTags"></div>
          <div class="overview" id="tvOverview"></div>
        </div>
      </div>
    </aside>
  </main>

  <footer>BDTV VOD.</footer>

  <script>
    const TMDB_API_KEY = "b14194d00ce48c36318eefa745bcdeec";
    const TMDB_BASE = "https://api.themoviedb.org/3";
    const TMDB_IMG_BASE = "https://image.tmdb.org/t/p/w300";

    function getTvIdFromUrl() {
      const url = new URL(window.location.href);
      return url.searchParams.get("id");
    }

    async function fetchJson(url) {
      const res = await fetch(url);
      if (!res.ok) throw new Error("TMDB error " + res.status);
      return res.json();
    }

    function openActor(personId) {
      window.location.href = `actor.html?id=${encodeURIComponent(personId)}`;
    }

    async function loadTvShow() {
      const tvId = getTvIdFromUrl() || "119051";
      // set iframe source later after metadata loaded
      const params = new URLSearchParams({
        color: "e50914",
        autoPlay: "true",
        nextEpisode: "true",
        episodeSelector: "true",
      });
      document.getElementById("tvFrame").src = `https://www.vidking.net/embed/tv/${encodeURIComponent(tvId)}/1/1?${params.toString()}`;

      try {
        const url = `${TMDB_BASE}/tv/${encodeURIComponent(tvId)}?api_key=${TMDB_API_KEY}&language=en-US`;
        const creditsUrl = `${TMDB_BASE}/tv/${encodeURIComponent(tvId)}/credits?api_key=${TMDB_API_KEY}&language=en-US`;

        const [data, credits] = await Promise.all([fetchJson(url), fetchJson(creditsUrl)]);

        const name = data.name || "Untitled";
        const year = data.first_air_date ? data.first_air_date.slice(0,4) : "";
        const rating = data.vote_average ? `⭐ ${data.vote_average.toFixed(1)}` : "";

        document.getElementById("tvTitle").textContent = name;
        document.getElementById("tvMeta").textContent = [year, rating].filter(Boolean).join(" • ");

        const tagContainer = document.getElementById("tvTags");
        tagContainer.innerHTML = "";
        (data.genres || []).forEach(g => {
          const span = document.createElement("span");
          span.className = "tag-chip";
          span.textContent = g.name;
          tagContainer.appendChild(span);
        });

        document.getElementById("tvOverview").textContent = data.overview || "No overview available.";

        const posterImg = document.getElementById("posterImg");
        if (data.poster_path) posterImg.src = TMDB_IMG_BASE + data.poster_path;
        else posterImg.src = "https://via.placeholder.com/300x450?text=No+Image";
        posterImg.alt = name + " poster";

        // cast
        const castList = (credits.cast || []).slice(0, 12);
        const castContainer = document.getElementById("castList");
        castContainer.innerHTML = "";
        if (castList.length) {
          document.getElementById("castSection").style.display = "";
          for (const c of castList) {
            const item = document.createElement("div");
            item.className = "cast-item";
            const img = document.createElement("img");
            if (c.profile_path) img.src = "https://image.tmdb.org/t/p/w185" + c.profile_path;
            else img.src = "https://via.placeholder.com/185x185?text=No+Photo";
            img.alt = c.name || "Actor";

            const name = document.createElement("div");
            name.className = "cast-name";
            name.textContent = c.name;

            const char = document.createElement("div");
            char.className = "cast-character";
            char.textContent = c.character || "";

            item.appendChild(img);
            item.appendChild(name);
            item.appendChild(char);

            item.addEventListener("click", () => {
              if (c.id) openActor(c.id);
            });

            castContainer.appendChild(item);
          }
        } else {
          document.getElementById("castSection").style.display = "none";
        }

      } catch (err) {
        console.error(err);
        document.getElementById("tvTitle").textContent = "Failed to load TV details.";
      }
    }

    loadTvShow();
  </script>
</body>
</html>